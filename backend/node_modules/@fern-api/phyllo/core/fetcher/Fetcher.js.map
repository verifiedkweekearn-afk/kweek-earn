{
  "version": 3,
  "sources": ["../../src/core/fetcher/Fetcher.ts"],
  "sourcesContent": ["import axios, { AxiosError } from \"axios\";\nimport { APIResponse } from \"./APIResponse\";\n\nexport interface Fetcher {\n  fetch: FetchFunction;\n}\n\nexport type FetchFunction = (args: Fetcher.Args) => Promise<APIResponse<unknown, Fetcher.Error>>;\n\nexport declare namespace Fetcher {\n  export interface Args {\n    url: string;\n    method: string;\n    headers?: Record<string, string | undefined>;\n    queryParameters?: URLSearchParams;\n    body?: unknown;\n    timeoutMs?: number;\n  }\n\n  export type Error = FailedStatusCodeError | NonJsonError | TimeoutError | UnknownError;\n\n  export interface FailedStatusCodeError {\n    reason: \"status-code\";\n    statusCode: number;\n    body: unknown;\n  }\n\n  export interface NonJsonError {\n    reason: \"non-json\";\n    statusCode: number;\n    rawBody: string;\n  }\n\n  export interface TimeoutError {\n    reason: \"timeout\";\n  }\n\n  export interface UnknownError {\n    reason: \"unknown\";\n    errorMessage: string;\n  }\n}\n\nexport const fetcher: FetchFunction = async (args) => {\n  const headers: Record<string, string> = {\n    \"Content-Type\": \"application/json\",\n  };\n\n  if (args.headers != null) {\n    for (const [key, value] of Object.entries(args.headers)) {\n      if (value != null) {\n        headers[key] = value;\n      }\n    }\n  }\n\n  try {\n    const response = await axios({\n      url: args.url,\n      params: args.queryParameters,\n      method: args.method,\n      headers,\n      data: args.body,\n      validateStatus: () => true,\n      transformResponse: (response) => response,\n      timeout: args.timeoutMs ?? 60_000,\n      transitional: {\n        clarifyTimeoutError: true,\n      },\n    });\n\n    let body: unknown;\n    if (response.data != null) {\n      try {\n        body = JSON.parse(response.data) ?? undefined;\n      } catch {\n        return {\n          ok: false,\n          error: {\n            reason: \"non-json\",\n            statusCode: response.status,\n            rawBody: response.data,\n          },\n        };\n      }\n    }\n\n    if (response.status >= 200 && response.status < 300) {\n      return {\n        ok: true,\n        body,\n      };\n    } else {\n      return {\n        ok: false,\n        error: {\n          reason: \"status-code\",\n          statusCode: response.status,\n          body,\n        },\n      };\n    }\n  } catch (error) {\n    if ((error as AxiosError).code === \"ETIMEDOUT\") {\n      return {\n        ok: false,\n        error: {\n          reason: \"timeout\",\n        },\n      };\n    }\n\n    return {\n      ok: false,\n      error: {\n        reason: \"unknown\",\n        errorMessage: (error as AxiosError).message,\n      },\n    };\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkC;AA2C3B,MAAM,UAAyB,OAAO,SAAS;AACpD,QAAM,UAAkC;AAAA,IACtC,gBAAgB;AAAA,EAClB;AAEA,MAAI,KAAK,WAAW,MAAM;AACxB,eAAW,CAAC,KAAK,UAAU,OAAO,QAAQ,KAAK,OAAO,GAAG;AACvD,UAAI,SAAS,MAAM;AACjB,gBAAQ,OAAO;AAAA,MACjB;AAAA,IACF;AAAA,EACF;AAEA,MAAI;AACF,UAAM,WAAW,MAAM,0BAAM;AAAA,MAC3B,KAAK,KAAK;AAAA,MACV,QAAQ,KAAK;AAAA,MACb,QAAQ,KAAK;AAAA,MACb;AAAA,MACA,MAAM,KAAK;AAAA,MACX,gBAAgB,MAAM;AAAA,MACtB,mBAAmB,CAAC,cAAa;AAAA,MACjC,SAAS,KAAK,aAAa;AAAA,MAC3B,cAAc;AAAA,QACZ,qBAAqB;AAAA,MACvB;AAAA,IACF,CAAC;AAED,QAAI;AACJ,QAAI,SAAS,QAAQ,MAAM;AACzB,UAAI;AACF,eAAO,KAAK,MAAM,SAAS,IAAI,KAAK;AAAA,MACtC,QAAE;AACA,eAAO;AAAA,UACL,IAAI;AAAA,UACJ,OAAO;AAAA,YACL,QAAQ;AAAA,YACR,YAAY,SAAS;AAAA,YACrB,SAAS,SAAS;AAAA,UACpB;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,QAAI,SAAS,UAAU,OAAO,SAAS,SAAS,KAAK;AACnD,aAAO;AAAA,QACL,IAAI;AAAA,QACJ;AAAA,MACF;AAAA,IACF,OAAO;AACL,aAAO;AAAA,QACL,IAAI;AAAA,QACJ,OAAO;AAAA,UACL,QAAQ;AAAA,UACR,YAAY,SAAS;AAAA,UACrB;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF,SAAS,OAAP;AACA,QAAK,MAAqB,SAAS,aAAa;AAC9C,aAAO;AAAA,QACL,IAAI;AAAA,QACJ,OAAO;AAAA,UACL,QAAQ;AAAA,QACV;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,MACL,IAAI;AAAA,MACJ,OAAO;AAAA,QACL,QAAQ;AAAA,QACR,cAAe,MAAqB;AAAA,MACtC;AAAA,IACF;AAAA,EACF;AACF;",
  "names": []
}
